(function(a){function g(a){for(var b=Array(a.length),c=0,d=a.length;d>c;c++)b[c]=255&a.charCodeAt(c);return b}var b=this,c={ArrayBuffer:"undefined"!=typeof ArrayBuffer,DataView:"undefined"!=typeof DataView&&("getFloat64"in DataView.prototype||"getFloat64"in new DataView(new ArrayBuffer(1))),NodeBuffer:"undefined"!=typeof Buffer&&"readInt16LE"in Buffer.prototype},d={Int8:1,Int16:2,Int32:4,Uint8:1,Uint16:2,Uint32:4,Float32:4,Float64:8},e={Int8:"Int8",Int16:"Int16",Int32:"Int32",Uint8:"UInt8",Uint16:"UInt16",Uint32:"UInt32",Float32:"Float",Float64:"Double"},f=function(a,g,h,i){if(!(this instanceof f))throw Error("jDataView constructor may not be called as a function");if(this.buffer=a=f.wrapBuffer(a),this._isArrayBuffer=c.ArrayBuffer&&a instanceof ArrayBuffer,this._isDataView=c.DataView&&this._isArrayBuffer,this._isNodeBuffer=c.NodeBuffer&&a instanceof Buffer,!(this._isNodeBuffer||this._isArrayBuffer||a instanceof Array))throw new TypeError("jDataView buffer has an incompatible type");this._littleEndian=Boolean(i);var j=this._isArrayBuffer?a.byteLength:a.length;if(void 0===g&&(g=0),this.byteOffset=g,void 0===h&&(h=j-g),this.byteLength=h,!this._isDataView){if("number"!=typeof g)throw new TypeError("jDataView byteOffset is not a number");if("number"!=typeof h)throw new TypeError("jDataView byteLength is not a number");if(0>g)throw Error("jDataView byteOffset is negative");if(0>h)throw Error("jDataView byteLength is negative")}if(this._isDataView&&(this._view=new DataView(a,g,h)),this._start=g,g+h>j)throw Error("jDataView (byteOffset + byteLength) value is out of bounds");if(this._offset=0,this._isDataView)for(var k in d)d.hasOwnProperty(k)&&function(a,b){var c=d[a];b["get"+a]=function(d,e){return void 0===e&&(e=b._littleEndian),void 0===d&&(d=b._offset),b._offset=d+c,b._view["get"+a](d,e)},b["set"+a]=function(d,e,f){void 0===f&&(f=b._littleEndian),void 0===d&&(d=b._offset),b._offset=d+c,b._view["set"+a](d,e,f)}}(k,this);else if(this._isNodeBuffer)for(var k in d)d.hasOwnProperty(k)&&function(a,b){var c=d[a];b["get"+a]=function(d,f){void 0===f&&(f=b._littleEndian),void 0===d&&(d=b._offset);var g;return g="Int8"===a||"Uint8"===a?"read"+e[a]:f?"read"+e[a]+"LE":"read"+e[a]+"BE",b._offset=d+c,b.buffer[g](b._start+d)},b["set"+a]=function(d,f,g){void 0===g&&(g=b._littleEndian),void 0===d&&(d=b._offset);var h;h="Int8"===a||"Uint8"===a?"write"+e[a]:g?"write"+e[a]+"LE":"write"+e[a]+"BE",b._offset=d+c,b.buffer[h](f,b._start+d)}}(k,this);else if(this._isArrayBuffer)for(var k in d)d.hasOwnProperty(k)&&function(a,c){var e=d[a];c["get"+a]=function(d,f){void 0===f&&(f=c._littleEndian),void 0===d&&(d=c._offset);var g,h;return 1===e||0===(c._start+d)%e&&f?(g=c.buffer,h=c._start+d,c._offset=d+e):(g=new Uint8Array(c.getBytes(e,d,f)).buffer,h=0),new b[a+"Array"](g,h,1)[0]},c["set"+a]=function(d,f,g){void 0===g&&(g=c._littleEndian),void 0===d&&(d=c._offset);var h=b[a+"Array"];if(1===e||0===(c._start+d)%e&&g)new h(c.buffer,c._start+d,1)[0]=f,c._offset=d+e;else{var i=new Uint8Array(e);new h(i.buffer,0,1)[0]=f,c.setBytes(d,i,g)}}}(k,this);else for(var k in d)d.hasOwnProperty(k)&&function(a,b){var c=d[a];b["get"+a]=function(d,e){if(void 0===e&&(e=b._littleEndian),void 0===d&&(d=b._offset),"number"!=typeof d)throw new TypeError("jDataView byteOffset is not a number");if(d+c>b.byteLength)throw Error("jDataView (byteOffset + size) value is out of bounds");return b["_get"+a](d,e)},b["set"+a]=function(d,e,f){if(void 0===f&&(f=b._littleEndian),void 0===d&&(d=b._offset),b._offset=d+c,"number"!=typeof d)throw new TypeError("jDataView byteOffset is not a number");if(d+c>b.byteLength)throw Error("jDataView (byteOffset + size) value is out of bounds");b["_set"+a.replace("Uint","Int")](d,e,f)}}(k,this);for(var k in d)d.hasOwnProperty(k)&&function(a,b){b["write"+a]=function(b,c){this["set"+a](void 0,b,c)}}(k,this)};f.wrapBuffer=function(a){switch(typeof a){case"string":a=g(a);break;case"number":a={length:a}}if("length"in a&&!(c.NodeBuffer&&a instanceof Buffer||c.ArrayBuffer&&a instanceof ArrayBuffer))if(c.NodeBuffer)a=new Buffer(a);else if(c.ArrayBuffer){var b=a instanceof Uint8Array?a:new Uint8Array(a);a=b.buffer}else{a instanceof Array||(a=Array.prototype.slice.call(a));for(var d=0,e=a.length;e>d;d++)a[d]&=255}return a},f.createBuffer=function(){return f.wrapBuffer(arguments)},f.prototype={compatibility:c,_getBytes:function(a,b,c){var d;if(void 0===c&&(c=this._littleEndian),void 0===b&&(b=this._offset),void 0===a&&(a=this.byteLength-b),"number"!=typeof b)throw new TypeError("jDataView byteOffset is not a number");if(0>a||b+a>this.byteLength)throw Error("jDataView length or (byteOffset+length) value is out of bounds");return b+=this._start,d=this._isArrayBuffer?new Uint8Array(this.buffer,b,a):this.buffer.slice(b,b+a),!c&&a>1&&(d instanceof Array||(d=Array.prototype.slice.call(d)),d.reverse()),this._offset=b-this._start+a,d},getBytes:function(){var d=this._getBytes.apply(this,arguments);return d instanceof Array||(d=Array.prototype.slice.call(d)),d},setBytes:function(a,b,c){var d=b.length;if(void 0===c&&(c=this._littleEndian),void 0===a&&(a=this._offset),"number"!=typeof a)throw new TypeError("jDataView byteOffset is not a number");if(0>d||a+d>this.byteLength)throw Error("jDataView length or (byteOffset+length) value is out of bounds");if(!c&&d>1&&(b=Array.prototype.slice.call(b).reverse()),a+=this._start,this._isArrayBuffer)new Uint8Array(this.buffer,a,d).set(b);else if(this._isNodeBuffer)new Buffer(b).copy(this.buffer,a);else for(var e=0;d>e;e++)this.buffer[a+e]=b[e];this._offset=a-this._start+d},writeBytes:function(a,b){this.setBytes(void 0,a,b)},getString:function(a,b){return String.fromCharCode.apply(null,this._getBytes(a,b,!0))},setString:function(a,b){this.setBytes(a,g(b),!0)},writeString:function(a){this.setString(void 0,a)},getChar:function(a){return this.getString(1,a)},setChar:function(){this.setString.apply(this,arguments)},writeChar:function(a){this.setChar(void 0,a)},tell:function(){return this._offset},seek:function(a){if("number"!=typeof a)throw new TypeError("jDataView byteOffset is not a number");if(0>a||a>this.byteLength)throw Error("jDataView byteOffset value is out of bounds");return this._offset=a},slice:function(a,b,c){return c?new f(this.getBytes(b-a,a),void 0,void 0,!0):new f(this.buffer,this._start+a,b-a,this._littleEndian)},_getFloat64:function(a,b){var c=this._getBytes(8,a,b),d=1-2*(c[7]>>7),e=((255&c[7]<<1)<<3|c[6]>>4)-1023,f=(15&c[6])*Math.pow(2,48)+c[5]*Math.pow(2,40)+c[4]*Math.pow(2,32)+c[3]*Math.pow(2,24)+c[2]*Math.pow(2,16)+c[1]*Math.pow(2,8)+c[0];return 1024===e?0!==f?0/0:1/0*d:-1023===e?d*f*Math.pow(2,-1074):d*(1+f*Math.pow(2,-52))*Math.pow(2,e)},_getFloat32:function(a,b){var c=this._getBytes(4,a,b),d=1-2*(c[3]>>7),e=(255&c[3]<<1|c[2]>>7)-127,f=(127&c[2])<<16|c[1]<<8|c[0];return 128===e?0!==f?0/0:1/0*d:-127===e?d*f*Math.pow(2,-149):d*(1+f*Math.pow(2,-23))*Math.pow(2,e)},_getInt32:function(a,b){var c=this._getBytes(4,a,b);return c[3]<<24|c[2]<<16|c[1]<<8|c[0]},_getUint32:function(a,b){return this._getInt32(a,b)>>>0},_getInt16:function(a,b){return this._getUint16(a,b)<<16>>16},_getUint16:function(a,b){var c=this._getBytes(2,a,b);return c[1]<<8|c[0]},_getInt8:function(a){return this._getUint8(a)<<24>>24},_getUint8:function(a){return this._getBytes(1,a)[0]},_setBinaryFloat:function(a,b,c,d,e){var g,h,f=0>b?1:0,i=~(-1<<d-1),j=1-i;0>b&&(b=-b),0===b?(g=0,h=0):isNaN(b)?(g=2*i+1,h=1):1/0===b?(g=2*i+1,h=0):(g=Math.floor(Math.log(b)/Math.LN2),g>=j&&i>=g?(h=Math.floor((b*Math.pow(2,-g)-1)*Math.pow(2,c)),g+=i):(h=Math.floor(b/Math.pow(2,j-c)),g=0));for(var k=[];c>=8;)k.push(h%256),h=Math.floor(h/256),c-=8;for(g=g<<c|h,d+=c;d>=8;)k.push(255&g),g>>>=8,d-=8;k.push(f<<d|g),this.setBytes(a,k,e)},_setFloat32:function(a,b,c){this._setBinaryFloat(a,b,23,8,c)},_setFloat64:function(a,b,c){this._setBinaryFloat(a,b,52,11,c)},_setInt32:function(a,b,c){this.setBytes(a,[255&b,255&b>>>8,255&b>>>16,b>>>24],c)},_setInt16:function(a,b,c){this.setBytes(a,[255&b,b>>>8],c)},_setInt8:function(a,b){this.setBytes(a,[b])}},"undefined"!=typeof module&&a===module.exports?module.exports=f:a.jDataView=f})(this);